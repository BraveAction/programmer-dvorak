//Typing Tutor jQuery plugin
// https://github.com/denisk20/TypingTutor
//Minified with google closure compiler:
//http://closure-compiler.appspot.com/home
(function(b){b.fn.typingtutor=function(n){function B(a,b){d[a]&&d[a][b]&&d[a][b].css("background-color",L)}function t(a,b){d[a]&&d[a][b]&&d[a][b].css("background-color",C)}function h(a,b){d[a]&&d[a][b]&&d[a][b].css("background-color",M)}function D(){u=!0;v++;w&&w.call(this,v)}function x(a,b){d[a]&&d[a][b]&&d[a][b].css("background-color",N);q=null;k.length=0;D()}function E(){var a=e.value,c=a.split(/\n/g);"msie"===b.browser.name&&-1!==a.indexOf("\n",a.length-1)&&c.push("");return c}function y(){var a=
E();return a[a.length-1]}n=b.extend({speedInterval:4},n);var F=this[0],e=this[1];b(e).css("resize","none");b(e).attr("onpaste","return false;");for(var c=0,l=b(F).find("p"),g=[],d=[],r=0,f=0;f<l.length;f++){l[f]=b(l[f]);var m=b.trim(l[f].text()).replace(/\t/g," "),r=r+m.length;l[f][0].innerHTML="";g[f]=m;d[f]=[];for(var s=0;s<m.length;s++){var G=b("<span>"+m.charAt(s)+"</span>");l[f].append(G);d[f][s]=G}m=b("<span>&nbsp;</span>");d[f][s]=m;l[f].append(m);g[f]+=" "}r-=1;b(F).css("font-family",'"Courier New", Courier, monospace');
h(0,0);var L="rgb(201, 255, 224)",C="rgb(255, 255, 255)",M="rgb(198, 222, 162)",N="rgb(255, 97, 136)",O=n.speedInterval,q,k=[],z=n.speedTrackCallback,H=n.finishCallback,A=null,v=0,w=n.errorCallback,u=!1,I=function(a){A||(A=(new Date).getTime());if(8!==a.keyCode&&13!==a.keyCode){var p=y(),d=p.length;if(g[c])if(d>=g[c].length-1&&32===a.which)a.preventDefault(),a=new jQuery.Event("keydown"),a.which=a.keyCode=13,b(e).trigger(a),b(e).val(b(e).val()+"\n");else if(d>g[c].length-1)D();else if(g[c].substring(0,
d+1)===p+String.fromCharCode(a.which)){u=!1;B(c,d);h(c,d+1);if(z){p=(new Date).getTime();if(q&&(k.push(p-q),k.length===O)){var f=0;b.each(k,function(a,b){f+=b});z.call(this,parseInt(6E4/(f/k.length)));k.length=0}q=p}H&&(!u&&g.length-1===c&&g[g.length-1].length-2===d)&&(d=(new Date).getTime()-A,H.call(this,parseInt(6E4*(r/d))),b(e).val(b(e).val()+String.fromCharCode(a.which)),b(e).attr("disabled",!0),b(e).unbind("keypress"),b(e).unbind("keydown"),b(e).unbind("keyup"))}else x(c,d)}},J=function(a){if(8===
a.keyCode){var d=y();a=d.length;0<a?g[c]&&(a<g[c].length&&t(c,a),1<a?a-1<g[c].length&&(t(c,a-1),g[c].substring(0,a-1)===d.substring(0,a-1)?h(c,a-1):x(c,a-2)):h(c,0)):0!==c&&g[c]&&(t(c,0),c--,d=E()[c],a=d.length+1,b.trim(g[c]).substring(0,a-1)===b.trim(d).substring(0,a-1)?h(c,a-1):x(c,a-2))}else 13===a.keyCode&&(d=y(),b.trim(g[c])!==d?(x(c,d.length),a.preventDefault()):(B(c,d.length),c++,h(c,0)))},K=function(a){a=y();var e=a.length;if(!(e>=d[c].length)){for(var f=e+1;f<d[c].length;f++)t(c,f);b.trim(g[c]).substring(0,
e-1)===b.trim(a).substring(0,e-1)&&h(c,e)}};b(e).keypress(I);b(e).keydown(J);b(e).keyup(K);b(e).focus();h(0,0);return{restart:function(){b(e).unbind("keypress");b(e).unbind("keydown");b(e).unbind("keyup");b.each(d,function(a,c){b.each(c,function(a,b){b.css("background-color",C)})});h(0,0);c=0;b(e).val("").attr("disabled",!1).focus();v=0;w&&w.call(this,v);u=!1;z&&z.call(this,0);q=null;k.length=0;A=null;b(e).keypress(I);b(e).keydown(J);b(e).keyup(K)}}}})(jQuery);
