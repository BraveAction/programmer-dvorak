//Typing Tutor jQuery plugin
// https://github.com/denisk20/TypingTutor
//Minified with google closure compiler:
//http://closure-compiler.appspot.com/home
(function(b){b.fn.typingtutor=function(u){function D(a,b){e[a]&&e[a][b]&&e[a][b].css("background-color",L)}function v(a,b){e[a]&&e[a][b]&&e[a][b].css("background-color",h.textBackgroundColor)}function k(a,b){e[a]&&e[a][b]&&(e[a][b].css("background-color",M),N(a,b-1))}function E(){q=!0;w++;x&&x.call(this,w);h.nextKeyCallback&&h.nextKeyCallback.call(this,8)}function C(a,b){e[a]&&e[a][b]&&e[a][b].css("background-color",O);r=null;l.length=0;E()}function F(){var a=c.value,d=a.split(/\n/g);"msie"===b.browser.name&&
-1!==a.indexOf("\n",a.length-1)&&d.push("");return d}function y(){var a=F();return a[a.length-1]}function N(a,b){if(h.nextKeyCallback){var d=g[a],c=b+1;d.length>c&&(" "===d.charAt(c)&&c===d.length-1?(h.nextKeyCallback.call(this,13,32),z.nextKeys=[13,32]):(d=d.charCodeAt(c),h.nextKeyCallback.call(this,d),z.nextKeys=d))}}var h=b.extend({speedInterval:4,focus:!1,textBackgroundColor:"#ffffff"},u);u=this[0];var c=this[1];b(c).css("resize","none");b(c).attr("onpaste","return false;");b(c).attr("oncut",
"return false;");b(c).attr("spellcheck","false");for(var d=0,m=b(u).find("p"),g=[],e=[],s=0,f=0;f<m.length;f++){m[f]=b(m[f]);var n=b.trim(m[f].text()).replace(/\t/g," "),s=s+n.length;m[f][0].innerHTML="";g[f]=n;e[f]=[];for(var t=0;t<n.length;t++){var G=b("<span>"+n.charAt(t)+"</span>");m[f].append(G);e[f][t]=G}n=b("<span>&nbsp;</span>");e[f][t]=n;m[f].append(n);g[f]+=" "}s-=1;b(u).css("font-family",'"Courier New", Courier, monospace');var L="#c9ffe0",M="#c6dea2",O="#ff6188",P=h.speedInterval,r,l=
[],A=h.speedTrackCallback,H=h.finishCallback,B=null,w=0,x=h.errorCallback,q=!1,z={},I=function(a){B||(B=(new Date).getTime());if(8!==a.keyCode&&13!==a.keyCode){var p=y(),e=p.length;if(g[d])if(e>=g[d].length-1&&!q&&32===a.which)a.preventDefault(),a=new jQuery.Event("keydown"),a.which=a.keyCode=13,b(c).trigger(a),b(c).val(b(c).val()+"\n"),"msie"===b.browser.name&&(a=b(c)[0].createTextRange(),a.collapse(!1),a.select());else if(e>g[d].length-1)E();else if(g[d].substring(0,e+1)===p+String.fromCharCode(a.which)){q=
!1;D(d,e);k(d,e+1);if(A){p=(new Date).getTime();if(r&&(l.push(p-r),l.length===P)){var f=0;b.each(l,function(a,b){f+=b});A.call(this,parseInt(6E4/(f/l.length)));l.length=0}r=p}H&&(!q&&g.length-1===d&&g[g.length-1].length-2===e)&&(e=(new Date).getTime()-B,H.call(this,parseInt(6E4*(s/e))),b(c).val(b(c).val()+String.fromCharCode(a.which)),b(c).attr("disabled",!0),b(c).unbind("keypress"),b(c).unbind("keydown"),b(c).unbind("keyup"))}else C(d,e)}},J=function(a){if(-1!==b.inArray(a.keyCode,[37,38,39,40]))a.preventDefault();
else if(36!==a.keyCode||a.shiftKey)if(8===a.keyCode){var c=y();a=c.length;0<a?g[d]&&(a<g[d].length&&v(d,a),1<a?a-1<g[d].length&&(v(d,a-1),g[d].substring(0,a-1)===c.substring(0,a-1)&&k(d,a-1)):k(d,0)):0!==d&&g[d]&&(v(d,0),d--,c=F()[d],a=c.length+1,b.trim(g[d]).substring(0,a-1)===b.trim(c).substring(0,a-1)?k(d,a-1):C(d,a-2))}else 13===a.keyCode&&(c=y(),b.trim(g[d])!==c?(C(d,c.length),a.preventDefault()):(D(d,c.length),d++,k(d,0)));else a.preventDefault()},K=function(a){var c=y(),f=c.length;if(!(f>=
e[d].length)){for(var h=f+1;h<e[d].length;h++)v(d,h);(a.ctrlKey||a.shiftKey||46===a.keyCode)&&b.trim(g[d]).substring(0,f-1)===b.trim(c).substring(0,f-1)&&k(d,f)}};b(c).keypress(I);b(c).keydown(J);b(c).keyup(K);b(c).mouseup(function(){var a=b(c).val();b(c).focus().val("").val(a)});h.focus&&b(c).focus();k(0,0);z.restart=function(){b(c).unbind("keypress");b(c).unbind("keydown");b(c).unbind("keyup");b.each(e,function(a,c){b.each(c,function(a,b){b.css("background-color",h.textBackgroundColor)})});k(0,
0);d=0;b(c).val("").attr("disabled",!1);w=0;x&&x.call(this,w);q=!1;A&&A.call(this,0);r=null;l.length=0;B=null;b(c).keypress(I);b(c).keydown(J);b(c).keyup(K)};return z}})(jQuery);
